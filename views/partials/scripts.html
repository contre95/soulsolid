{{define "scripts"}}
<script>
  function toggleDarkMode() {
    console.log("toggleDarkMode called");
    document.documentElement.classList.toggle("dark");
    // Optional: Persist the theme preference
    if (document.documentElement.classList.contains("dark")) {
      localStorage.theme = "dark";
      console.log("Switched to dark mode");
    } else {
      localStorage.theme = "light";
      console.log("Switched to light mode");
    }
  }
  if (
    localStorage.theme === "dark" ||
    (!("theme" in localStorage) &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.documentElement.classList.add("dark");
    console.log("Initial dark mode applied");
  } else {
    document.documentElement.classList.remove("dark");
    console.log("Initial light mode applied");
  }

  // SlimSelect initialization for tag edit form
  function initSlimSelect() {
    // Destroy existing instances
    if (window.albumSelect) window.albumSelect.destroy();
    if (window.albumArtistSelect) window.albumArtistSelect.destroy();
    if (window.artistSelect) window.artistSelect.destroy();

    // Initialize new instances
    if (document.getElementById("album")) {
      window.albumSelect = new SlimSelect({
        select: "#album",
      });
    }
    if (document.getElementById("album_artist")) {
      window.albumArtistSelect = new SlimSelect({
        select: "#album_artist",
      });
    }
    if (document.getElementById("artist")) {
      window.artistSelect = new SlimSelect({
        select: "#artist",
      });
    }
  }

  // Initialize on page load
  document.addEventListener("DOMContentLoaded", initSlimSelect);

  // Re-initialize after HTMX swaps, but only for the main content area
  document.addEventListener("htmx:afterSettle", function (event) {
    // Only reinitialize if the target is the main content area
    if (event.target && event.target.id === "contenido") {
      initSlimSelect();
    }
  });

  // Queue grouping button activation
  function activateGroupingButton(groupingType) {
    // Remove active state from all buttons
    document.querySelectorAll('.view-toggle-btn').forEach(btn => {
      btn.classList.remove('active', 'bg-white', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'shadow-sm');
      btn.classList.add('text-gray-600', 'dark:text-gray-400');
    });

    // Add active state to target button
    const targetBtn = document.getElementById(`view-${groupingType}`);
    if (targetBtn) {
      targetBtn.classList.add('active', 'bg-white', 'dark:bg-gray-700', 'text-gray-700', 'dark:text-gray-300', 'shadow-sm');
      targetBtn.classList.remove('text-gray-600', 'dark:text-gray-400');
    }
  }
</script>
{{end}}
